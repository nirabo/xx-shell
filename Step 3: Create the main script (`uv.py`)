import subprocess
import sqlite3
from datetime import datetime

# Initialize database connection
conn = sqlite3.connect('commands.db')
cursor = conn.cursor()

# Create table if it doesn't exist
cursor.execute('''
CREATE TABLE IF NOT EXISTS commands (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    command TEXT NOT NULL,
    output TEXT NOT NULL,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
)
''')

def execute_command(command):
    try:
        # Execute the command
        result = subprocess.run(command, shell=True, check=True, capture_output=True, text=True)
        
        # Store the command and its output in the database
        cursor.execute('INSERT INTO commands (command, output) VALUES (?, ?)', (command, result.stdout))
        conn.commit()
        
        return result.stdout
    except subprocess.CalledProcessError as e:
        # Store the command and its error in the database
        cursor.execute('INSERT INTO commands (command, output) VALUES (?, ?)', (command, e.stderr))
        conn.commit()
        
        return e.stderr

def main():
    while True:
        user_input = input("xx> ")
        if user_input.lower() == 'exit':
            break
        output = execute_command(user_input)
        print(output)

if __name__ == "__main__":
    main()
